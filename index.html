<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Simple App</title>
        <style>
            .pre-output {
                width: 100%;
                max-width: 600px;
                min-height: 200px;
                margin-top: 20px;
                padding: 15px;
                font-family: monospace;
                background-color: #f5f5f5;
                border: 1px solid #ccc;
                border-radius: 4px;
                white-space: pre-wrap;
                word-wrap: break-word;
                overflow-x: auto;
            }

            .button {
                padding: 10px 20px;
                font-size: 16px;
                cursor: pointer;
                background-color: #4caf50;
                color: white;
                border: none;
                border-radius: 4px;
            }

            .button:hover {
                background-color: #45a049;
            }
        </style>
    </head>
    <body>
        <h1>Simple App</h1>
        <button onclick="makeCoreLnRequest()">Make Coreln Request</button>
        <button onclick="makeEclairRequest()">Make Eclair Request</button>
        <button onclick="makeLndRequest()">Make LND Request</button>
        <pre id="response" class="pre-output">Response will appear here...</pre>
        <script>
            const coreln = "https://localhost:9097/v1";
            const rune = "LlxDJVZ3zcf-i111R31K4i3dVAgRK7AX8oN2YhpvHQ09MA==";

            const lnd = "https://localhost:9103/v1";
            const macaroon =
                "0201036c6e6402f801030a10aa26910b76937f3eabfbccdbfd2a80081201301a160a0761646472657373120472656164120577726974651a130a04696e666f120472656164120577726974651a170a08696e766f69636573120472656164120577726974651a210a086d616361726f6f6e120867656e6572617465120472656164120577726974651a160a076d657373616765120472656164120577726974651a170a086f6666636861696e120472656164120577726974651a160a076f6e636861696e120472656164120577726974651a140a057065657273120472656164120577726974651a180a067369676e6572120867656e6572617465120472656164000006202d38fbeaf23727b3f8bf2368f4ce0ca21913d74ae82ff4bc4ab0a2b649af2b30";

            const eclair = "localhost:9100";
            const password = "test1234";

            const corsProxyUrl = "http://localhost:8080";
            // if seeing cors issues, first go to 'https://localhost:9097/' or 'https://localhost:9103/' and accept the risk, the post endpoints will work
            // setting will stay for as long as the same browser session is open

            // coreln API docs https://docs.corelightning.org/reference/get_list_methods_resource
            // lnd API docs https://lightning.engineering/api-docs/api/lnd/index.html
            // eclair API docs https://acinq.github.io/eclair/#introduction

            // make the coreln and eclair nodes pay each other via bolt12!
            // coreln BOLT12: https://docs.corelightning.org/reference/lightning-offer -- create offer
            // eclair BOLT12: https://acinq.github.io/eclair/#payoffer -- pay offer
            async function makeCoreLnRequest() {
                const responseElement = document.getElementById("response");

                responseElement.textContent = "Making request to coreln...";

                try {
                    const response = await fetch(
                        `${corsProxyUrl}/${coreln}/getinfo`,
                        {
                            method: "POST",
                            headers: {
                                Rune: "LlxDJVZ3zcf-i111R31K4i3dVAgRK7AX8oN2YhpvHQ09MA==",
                            },
                        },
                    );

                    if (!response.ok) {
                        throw new Error(
                            `HTTP error! status: ${response.status}`,
                        );
                    }

                    const data = await response.json();
                    responseElement.textContent =
                        "Response:\n" + JSON.stringify(data, null, 2);
                } catch (error) {
                    console.error("Error:", error);
                    responseElement.textContent = "Error: " + error.message;
                }
            }

            async function makeEclairRequest() {
                const responseElement = document.getElementById("response");

                responseElement.textContent = "Making request to eclair...";
                const encodedCredentials = btoa(":" + password);
                console.log(encodedCredentials);
                try {
                    const response = await fetch(
                        `${corsProxyUrl}/${eclair}/getinfo`,
                        {
                            method: "POST",
                            headers: {
                                Authorization: `Basic ${encodedCredentials}`,
                            },
                        },
                    );

                    if (!response.ok) {
                        throw new Error(
                            `HTTP error! status: ${response.status}`,
                        );
                    }

                    const data = await response.json();
                    responseElement.textContent =
                        "Response:\n" + JSON.stringify(data, null, 2);
                } catch (error) {
                    console.error("Error:", error);
                    responseElement.textContent = "Error: " + error.message;
                }
            }

            async function makeLndRequest() {
                const responseElement = document.getElementById("response");
                responseElement.textContent = "Making request to lnd...";

                try {
                    const response = await fetch(
                        `${corsProxyUrl}/${lnd}/getinfo`,
                        {
                            method: "GET",
                            headers: {
                                "Grpc-Metadata-macaroon": macaroon,
                                "X-Requested-With": "XMLHttpRequest",
                            },
                        },
                    );

                    if (!response.ok) {
                        throw new Error(
                            `HTTP error! status: ${response.status}`,
                        );
                    }

                    const data = await response.json();
                    responseElement.textContent =
                        "Response:\n" + JSON.stringify(data, null, 2);
                } catch (error) {
                    console.error("Error:", error);
                    responseElement.textContent = "Error: " + error.message;
                }
            }
        </script>
    </body>
</html>
